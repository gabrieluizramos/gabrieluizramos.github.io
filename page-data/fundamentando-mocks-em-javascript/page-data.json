{"componentChunkName":"component---src-templates-post-article-index-js","path":"/fundamentando-mocks-em-javascript","result":{"data":{"markdownRemark":{"id":"0140c0a6-c239-5f47-88d3-82f6c152d915","html":"<p>Parte importante de cria√ß√£o de <a href=\"https://gabrieluizramos.com.br/voce-confia-em-si/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">confian√ßa com o software que voc√™ escreve</a> √© a consci√™ncia e a fundamenta√ß√£o sobre como utilizar corretamente alguma estrutura de <em>mocks</em> no seu c√≥digo.</p>\n<p>Um <em>mock</em> nada mais √© do que a substitui√ß√£o de um determinado trecho de c√≥digo por algo necess√°rio ao seu teste.</p>\n<p>Vamos imaginar o seguinte cen√°rio:</p>\n<blockquote>\n<p>Voc√™ est√° desenvolvendo um e-commerce e, na tela de pagamento, ao clicar no bot√£o \"finalizar compra\" a sua compra √© efetuada e voc√™ recebe uma confirma√ß√£o em uma modal com uma mensagem de sucesso</p>\n</blockquote>\n<p>Muito provavelmente voc√™ n√£o vai querer ficar simulando uma compra real a todo momento que executar seus testes unit√°rios. Se voc√™ fosse realizar algo dessa forma, teriam algumas vari√°veis que s√£o meio complicadas de serem previstas (conex√£o com internet, estabilidade e velocidade da conex√£o, tempo de resposta da API consumida) que poderiam impactar seus testes e que n√£o necessariamente entregariam algum valor pra voc√™ ou para seu teste. Sem contar que existem outros tipos de teste que podem assegurar esse cen√°rio.</p>\n<p>√â justamente nesse cen√°rio que os <em>mocks</em> caem como uma luva. Nesse exemplo voc√™ consegue substituir esses trechos de c√≥digo respons√°veis por retornar o sucesso ou falha da requisi√ß√£o de sua API (ou qualquer necessidade externa e ass√≠ncrona) por um outro trecho espec√≠fico. Assim consegue de fato trabalhar e moldar as asser√ß√µes do seu teste com o que voc√™ espera em cada um dos casos de teste.</p>\n<hr>\n<p><strong>Vale avisar que</strong>: utilizarei <em>mock</em> como um termo geral para facilitar a comunica√ß√£o. Mesmo que existam outras nomenclaturas (como <em>fake</em> para dados, <em>spies</em> para verifica√ß√£o de fun√ß√µes e <em>stubs</em> para sobrescrever comportamento), √© bem comum que chamemos tudo de <em>mock</em> no dia-a-dia.</p>\n<p>Lembrando que os exemplos citados aqui levam em considera√ß√£o a utiliza√ß√£o do <a href=\"https://jestjs.io\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jest</a> como ferramenta de teste, mas os conceitos podem ser reaproveitados para o framework que voc√™ estiver usando.</p>\n<hr>\n<h3>Antes de tudo, tenha em mente a unidade que voc√™ quer testar</h3>\n<p>Por desespero de fazer seus testes passarem √© muito comum \"sair <em>mockando</em> tudo\", mas isso pode ser muito pior do que voc√™ imagina.\nVoc√™ deve utilizar estruturas de <em>mock</em> quando sua unidade (fun√ß√£o ou trecho de c√≥digo) possui depend√™ncia de algo que n√£o est√° no escopo do seu teste.</p>\n<p>Voltando ao cen√°rio que mencionamos: o respons√°vel por disparar a real requisi√ß√£o para finalizar a compra √© o navegador ou dispositivo que est√° sendo utilizado.</p>\n<p>Portanto, qualquer a√ß√£o que envolva algo que n√£o seja espec√≠fico do bot√£o \"finalizar compra\" √© um poss√≠vel candidato a receber um <em>mock</em> durante o teste desse exemplo que imaginamos.</p>\n<h3>Criando <em>mocks</em></h3>\n<p>Existem duas formas principais de escrever um <em>mock</em> no Jest: criando um <em>mock</em> no teste que estiver sendo executado ou utilizando criando uma pasta <code class=\"language-text\">__mocks__</code> ao lado do arquivo que voc√™ estiver testando.</p>\n<p>Focaremos na primeira op√ß√£o (de criar os <em>mocks</em> em nossos testes) que √© o mais importante para o momento. O que muda para o segundo caso √© apenas a estrutura de pasta.</p>\n<p>No entanto, se quiser, voc√™ pode <a href=\"https://jestjs.io/docs/pt-BR/manual-mocks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ler a documenta√ß√£o</a> tamb√©m.</p>\n<h3>Tipos de <em>mock</em></h3>\n<p>Vamos dividir nossos <em>mocks</em> nas seguintes categorias:</p>\n<ul>\n<li>dados;</li>\n<li>fun√ß√µes.</li>\n</ul>\n<hr>\n<h4>Dados</h4>\n<p>Provavelmente o cen√°rio mais simples de <em>mock</em> que existe, mas muito fundamental.</p>\n<p>Vamos imaginar que n√≥s temos uma fun√ß√£o que recebe uma lista de personagens e um nome a ser filtrado.</p>\n<p>Algo como:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">filterCharacter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">characters<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> characters<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">char</span> <span class=\"token operator\">=></span> char <span class=\"token operator\">&amp;&amp;</span> char<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para conseguirmos testar essa fun√ß√£o, precisaremos utilizar uma lista de personagens (um <em>mock</em> no nosso teste) e algum par√¢metro de nome.</p>\n<p>Escrevendo nosso <em>mock</em>, para esse teste, podemos ter algo como:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mockCharacters <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'anakin skywalker'</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">:</span> <span class=\"token string\">'darth vader'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'leia organa'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'luke skywalker'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'r2-d2'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'c3po'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>E podemos escrever um teste para verificar todos os personagens com sobrenome <code class=\"language-text\">skywalker</code>, por exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> filterCharacter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./filter-character'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> mockCharacters <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'anakin skywalker'</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">:</span> <span class=\"token string\">'darth vader'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'leia organa'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'luke skywalker'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'r2-d2'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'c3po'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterCharacter'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filtra uma lista de personagens por um determinado nome'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> resultado <span class=\"token operator\">=</span> <span class=\"token function\">filterCharacter</span><span class=\"token punctuation\">(</span>mockCharacters<span class=\"token punctuation\">,</span> <span class=\"token string\">'skywalker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> esperado <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>resultado<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>esperado<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<hr>\n<h4>Fun√ß√µes</h4>\n<p>O Jest nos permite utilizar algumas <a href=\"https://jestjs.io/docs/pt-BR/jest-object#mock-functions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">fun√ß√µes espec√≠ficas</a> dependendo da necessidade do nosso teste e, para facilitar, vale a pena dividirmos esse t√≥pico em outros 3:</p>\n<ul>\n<li>fun√ß√µes comuns;</li>\n<li>m√≥dulos;</li>\n<li>espi√µes.</li>\n</ul>\n<h5>Fun√ß√µes comuns</h5>\n<p>Vamos imaginar que nossa fun√ß√£o de filtrar personagens, recebe um terceiro par√¢metro. Esse novo par√¢metro √© uma fun√ß√£o que verifica se o personagem est√° vivo, baseado em um campo <code class=\"language-text\">alive</code>.</p>\n<p>Nossa fun√ß√£o ser√° algo como:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">filterCharacter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">characters<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> isAlive</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> characters<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">char</span> <span class=\"token operator\">=></span> char <span class=\"token operator\">&amp;&amp;</span> char<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Essa fun√ß√£o n√£o est√° mais no escopo do nosso teste unit√°rio ent√£o podemos fazer um <em>mock</em> dela.</p>\n<p>Para realizar o <em>mock</em> de uma fun√ß√£o, utilizamos o seguinte m√©todo do Jest:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mock <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>O trecho <code class=\"language-text\">jest.fn()</code> retorna uma fun√ß√£o de <em>mock</em> para ser utilizada.</p>\n<p>Caso voc√™ precise simular o comportamento dessa fun√ß√£o com algum resultado pr√©-definido, voc√™ pode passar uma implementa√ß√£o de uma fun√ß√£o como par√¢metro ou utilizar alguns outros m√©todos e inclusive receber qualquer par√¢metro.</p>\n<p>Vamos imaginar que nossa fun√ß√£o sempre retorna <code class=\"language-text\">true</code>, por exemplo.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mockFn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ou utilizando .mockImplementation passando uma nova implementa√ß√£o</span>\n<span class=\"token keyword\">const</span> mockFn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ou utilizando .mockReturnedValue passando o valor de retorno diretamente</span>\n<span class=\"token keyword\">const</span> mockFn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockReturnedValue</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A lista completa dos m√©todos (vamos ver alguns a seguir) est√° <a href=\"https://jestjs.io/docs/pt-BR/mock-function-api#m%C3%A9todos\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">na documenta√ß√£o</a>.</p>\n<p>Dessa maneira, conseguimos verificar se a fun√ß√£o <code class=\"language-text\">isAlive</code> foi chamada ou n√£o corretamente com as asser√ß√µes:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// verifica se a fun√ß√£o foi chamada</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// verifica quantas vezes a fun√ß√£o foi chamada (exemplo: 2)</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// verifica que a fun√ß√£o n√£o foi chamada</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// verifica que a fun√ß√£o n√£o foi chamada com algum par√¢metro (exemplo: 'false')</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Vamos ao nosso teste:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> filterCharacter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./filter-character'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// mock atualizado com os valores de \"alive\"</span>\n<span class=\"token keyword\">const</span> mockCharacters <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'anakin skywalker'</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">:</span> <span class=\"token string\">'darth vader'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'leia organa'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'luke skywalker'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'r2-d2'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'c3po'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterCharacter'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filtra uma lista de personagens por um determinado nome e verifica se o personagem est√° vivo'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> mockIsAlive <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> resultado <span class=\"token operator\">=</span> <span class=\"token function\">filterCharacter</span><span class=\"token punctuation\">(</span>mockCharacters<span class=\"token punctuation\">,</span> <span class=\"token string\">'skywalker'</span><span class=\"token punctuation\">,</span> mockIsAlive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> esperado <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>resultado<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>esperado<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token comment\">// como a fun√ß√£o isAlive √© executada quando o personagem</span>\n    <span class=\"token comment\">// possui o nome passado como par√¢metro</span>\n    <span class=\"token comment\">// podemos verificar se foi executada a mesma quantidade de vezes</span>\n    <span class=\"token comment\">// que nosso resultado</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockIsAlive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span>resultado<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Se quiser fazer um exerc√≠cio, crie um novo caso de teste onde o <code class=\"language-text\">mock</code> da fun√ß√£o <code class=\"language-text\">isAlive</code> retornar <code class=\"language-text\">false</code>. ‚úèÔ∏è</p>\n<h5>M√≥dulos</h5>\n<p>Vamos imaginar que agora a fun√ß√£o <code class=\"language-text\">isAlive</code> n√£o √© mais recebida como par√¢metro, mas √© uma depend√™ncia externa (m√≥dulo) da fun√ß√£o <code class=\"language-text\">filterCharacter</code>.\nOu seja, agora temos algo como:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> isAlive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">filterCharacter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">characters<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> characters<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">char</span> <span class=\"token operator\">=></span> char <span class=\"token operator\">&amp;&amp;</span> char<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para conseguir cobrir esse cen√°rio, utilizaremos a fun√ß√£o <code class=\"language-text\">jest.mock</code>. Essa fun√ß√£o, recebe como par√¢metro o caminho do m√≥dulo que ser√° sobrescrito com o <em>mock</em> (no nosso caso <code class=\"language-text\">is-alive</code>) e pode receber como segundo par√¢metro (opcionalmente) uma fun√ß√£o que pode retornar manualmente os valores que o m√≥dulo exporta. Caso esse segundo par√¢metro n√£o seja passado, por padr√£o, o Jest far√° um <em>automocking</em> das fun√ß√µes e far√° <em>mock</em> de todos os valores exportados.</p>\n<p>Ou seja, para realizar o <em>mock</em> desse m√≥dulo, agora podemos seguir da seguinte maneira:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">jest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ou</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    isAlive<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A diferen√ßa da primeira pra segunda utiliza√ß√£o √© que a segunda nos permite customizar os valores exportados pelo m√≥dulo, caso precisemos. Caso voc√™ opte por utilizar a primeira, todos as fun√ß√µes exportadas pelo m√≥dulo j√° ser√£o sobrescritas por uma fun√ß√£o de <em>mock</em> igual ao retorno do <code class=\"language-text\">jest.fn</code> por padr√£o.</p>\n<p>Com isso, podemos manter nosso teste exatamente igual! A √∫nica diferen√ßa √© que n√£o precisaremos mais passar essa fun√ß√£o como par√¢metro e agora, ap√≥s realizar o <em>mock</em> de <code class=\"language-text\">is-alive</code>, iremos importar essa fun√ß√£o para verificar se ela foi de fato executada.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> filterCharacter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./filter-character'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// importamos o modulo</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> isAlive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">;</span>\n\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> isAlive<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> mockCharacters <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'anakin skywalker'</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">:</span> <span class=\"token string\">'darth vader'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'leia organa'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'luke skywalker'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'r2-d2'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'c3po'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterCharacter'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filtra uma lista de personagens por um determinado nome e verifica se o personagem est√° vivo'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> resultado <span class=\"token operator\">=</span> <span class=\"token function\">filterCharacter</span><span class=\"token punctuation\">(</span>mockCharacters<span class=\"token punctuation\">,</span> <span class=\"token string\">'skywalker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> esperado <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>resultado<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>esperado<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// modificamos para usar o import</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>isAlive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span>mockCharacters<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h5>Espi√µes</h5>\n<p>At√© agora s√≥ vimos como realizar <em>mock</em> das fun√ß√µes mas, se quis√©ssemos manter a execu√ß√£o de alguma fun√ß√£o, sem sobrescrever seu comportamento?</p>\n<p>Vamos imaginar que, agora, teremos um novo m√≥dulo chamado <code class=\"language-text\">logger</code>. Esse m√≥dulo exporta uma fun√ß√£o <code class=\"language-text\">log</code> que ser√° executado junto com o filtro. Da seguinte maneira:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> isAlive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> log <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./logger'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">filterCharacter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">characters<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> characters<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">char</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> char <span class=\"token operator\">&amp;&amp;</span> char<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isAlive</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>N√£o precisamos implementar essa nova fun√ß√£o, mas vamos imaginar que agora vamos apenas verificar se ela foi chamada corretamente, sem precisar nos preocupar com a forma que ela √© implementada.</p>\n<p>Para nos ajudar dessa vez, utilizaremos o m√©todo <a href=\"https://jestjs.io/docs/pt-BR/jest-object#jestspyonobject-methodname\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">spyOn</code></a> do jest. Esse m√©todo recebe como par√¢metro o objeto a ser \"espionado\" e a fun√ß√£o a ser verificada, da seguinte maneira:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// importamos tudo para que possamos verificar a fun√ß√£o `log`</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> logger <span class=\"token keyword\">from</span> <span class=\"token string\">'./logger'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">,</span> <span class=\"token string\">'log'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Dessa forma, seguimos nossos testes normalmente com o que j√° t√≠nhamos e validamos se nosso <em>mock</em> da fun√ß√£o <code class=\"language-text\">log</code> foi chamado corretamente.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> filterCharacter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./filter-character'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> isAlive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> logger <span class=\"token keyword\">from</span> <span class=\"token string\">'./logger'</span><span class=\"token punctuation\">;</span>\n\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./is-alive'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> isAlive<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> mockCharacters <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'anakin skywalker'</span><span class=\"token punctuation\">,</span> nickname<span class=\"token operator\">:</span> <span class=\"token string\">'darth vader'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'leia organa'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'luke skywalker'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'r2-d2'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'c3po'</span><span class=\"token punctuation\">,</span> alive<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterCharacter'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filtra uma lista de personagens por um determinado nome e verifica se o personagem est√° vivo'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> espiao <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">,</span> <span class=\"token string\">'log'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> resultado <span class=\"token operator\">=</span> <span class=\"token function\">filterCharacter</span><span class=\"token punctuation\">(</span>mockCharacters<span class=\"token punctuation\">,</span> <span class=\"token string\">'skywalker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> esperado <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>resultado<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>esperado<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>isAlive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span>resultado<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// como a fun√ß√£o log √© executada sempre</span>\n    <span class=\"token comment\">// que os personagens s√£o filtrado</span>\n    <span class=\"token comment\">// podemos verificar se a quantidade de vezes</span>\n    <span class=\"token comment\">// √© igual √† quantidade de personagens no mock</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>espiao<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span>mockCharacters<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<hr>\n<h3>üö® N√£o esque√ßa de \"limpar\" seus <em>mocks</em> üö®</h3>\n<p>Se tem uma coisa mais importante do que saber como utilizar um <em>mock</em> de forma consciente √© saber limpar um <em>mock</em> ap√≥s seus testes. Com certeza isso vai poupar uma dor de cabe√ßa e evitar que voc√™ possa ter problemas futuros em outros testes que tentem acessar seus m√≥dulos.</p>\n<p>Para fun√ß√µes de <code class=\"language-text\">spy</code>, basta executar o m√©todo <code class=\"language-text\">mockRestore</code>, da seguinte forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> espiao <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">,</span> <span class=\"token string\">'log'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ap√≥s o teste</span>\nespiao<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Para fun√ß√µes que manipulamos com <code class=\"language-text\">jest.fn()</code>, podemos utilizar outros m√©todos como:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mockFn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ap√≥s o teste</span>\n\n<span class=\"token comment\">// limpa as execu√ß√µes</span>\n<span class=\"token comment\">// mas mant√©m as implementa√ß√µes</span>\nmockFn<span class=\"token punctuation\">.</span><span class=\"token function\">mockClear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// limpa as execu√ß√µes</span>\n<span class=\"token comment\">// e as implementa√ß√µes</span>\nmockFn<span class=\"token punctuation\">.</span><span class=\"token function\">mockReset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// limpa as execu√ß√µes</span>\n<span class=\"token comment\">// e as implementa√ß√µes</span>\n<span class=\"token comment\">// e tamb√©m faz com que a fun√ß√£o retorne ao seu valor original</span>\n<span class=\"token comment\">// antes do mock</span>\nmockFn<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Muito provavelmente voc√™ vai querer automatizar essas limpezas em algum hook dos seus testes, como <a href=\"https://gabrieluizramos.com.br/anatomia-de-um-teste-em-javascript\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">vimos anteriormente</a>.</p>\n<hr>\n<h3>J√° utilizava <em>mock</em> nos seus testes?</h3>\n<p>J√° teve experi√™ncia (ou at√© mesmo dores de cabe√ßa) com alguma estrutura de <em>mock</em>?</p>\n<p>Espero que possa ter ajudado e que, de agora em diante, voc√™ possa utilizar essas ferramentas a favor dos testes que voc√™ estiver escrevendo!</p>","timeToRead":10,"frontmatter":{"date":"01/06/2020","path":"/fundamentando-mocks-em-javascript","title":"Fundamentando Mocks em JavaScript","subtitle":"Como utilizar essa abordagem de forma consciente e evitar retrabalho, preocupa√ß√µes e dores de cabe√ßa nos seus testes","banner":{"author":"J L","href":"https://unsplash.com/photos/kRaGJ42jfHI","image":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1200'%20height='750'%20viewBox='0%200%201200%20750'%20preserveAspectRatio='none'%3e%3cpath%20d='M368%2012l1%2012%202%2012%202%2024%202%2012v28l2%206%201%206%202%2013a158%20158%200%20004%2027l1%204%203%2018c0%2010%201%2013%205%2015l3%202%202%201c7%202%2010%205%2010%2010l2%209c2%203%202%204%201%205l-1%208-1%208c-2%200-1%202%202%205l2%206c0%204%200%205%202%205l1%201%202%203c2%202%204%207%205%2015l1%205c1%201%200%2016-1%2016l-3%2012-1%205-3%205-3%202c-2%200-5%203-5%205l-4%201c-5%200-6%201-4%204%201%201%201%201%202-1%203-3%204%200%203%2011%200%2011-3%2023-6%2027l-2%203c0%204-9%2015-11%2015s-2-1-2-5l1-7v-9l-4%202-6%202c-5%202-9%207-9%2013%200%208-3%2011-8%2010-10-2-10-10-1-24l6-13a240%20240%200%200110-23c3-8%2011-16%2017-16%202%200%205-3%206-7l3-5c2-2%203-4%203-7%201-6%203-12%205-12l1-3%201-4c3-2%203-5%201-5-1%200-2-1-2-3v-3l-3%202-3%204-2%203-5%202-3%203c-1%200-3%202-3%204l-4%204-1%201-6%207-6%207-3%204-6%2012-5%209-1%202-3%204-2%203-2%203-3%207c-1%203-2%207-4%208l-2%203-4%206c-4%204-4%205-4%2010l-1%207-2%203-1%203-3%207-3%2010-2%205-1%201-1%203-4%206c-6%207-7%2012-4%2019l2%202%201%204a7399%207399%200%200115%2035c5%2010%209%2012%2027%208l30-5c10-1%2014-2%2015-5%201-2-2-7-6-10-7-5-6-8%204-10%206-1%2010-5%2012-10a256%20256%200%200014-43c5-12%205-14%200-17-7-4-7-5-7-10a208%20208%200%200115-48c9-13%2016-35%2021-68a453%20453%200%20017-47c3-6%203-8%203-18l2-16%203-24%203-27c0-5%200-7-2-13l-8-17c-1-5-10-29-11-36a310%20310%200%2001-10-52V0h-73v12m624-7l1%205%201%203-1%203-1%202%201%202%201%202-2%202c-3%200-3%200-3%204l-1%204c-2%200-2%201-2%204%200%204%200%204-3%204-2%200-2%200-2%205v5l-1-1-2-1c-2%200-2%201-2%204l-1%204c-2%200-2%201-2%204s0%204%202%204l1%204c0%203%200%204%202%204l1-4-1-4c-3%200-2-5%201-9%204-4%205-4%205-1l2%202%201-4c0-4%200-4%204-4h3v8l1%208%202%202c1%202%2011%202%2011%200l-2-2c-3%200-3%200-3-4v-4h8v-4c0-3%200-4%202-4l1-8v-8h10V22h4l4%201%203%201c2%200%202%200%202%204l-1%204-1%204-1%204c-1%200-2%201-2%203%200%203%200%203-4%203l-4%201%204%201h4v8h-8v4l-1%204c-2%200-2%201-2%205s0%205%202%206l1%202%208%201%208%201-1%201c-2%200-2%201-2%204s0%204%202%204l1%204-1%204c-2%200-2%201-2%204%200%204%200%204-4%204l-5%202-3%201-1%201-6%201-7%201v2l2%202h3c0-2%202-2%202%200l5%203c2%201%203%203%202%203l-1%202%208%201c8%200%208%200%208%202%200%203-4%205-9%206-6%200-13%202-20%205l-12%204c-6%200-7%201-3%204%203%202%2012%203%2012%201s2-1%203%202l3%203%203%203%202%202%201%201h-6l-7-3-9-2a136%20136%200%2000-48%201c-3%200-4%202-4%208%200%205-1%206-6%206l-4%201%203%201%202%202%201%204c1%203%202%202%202-2l1-4%201%208c0%206%200%208%202%208l1%204-1%204c-2%200-2%202-2%208l-1%208-1%202c0%205-2%208-5%209l-3%204-1%201-1%202c0%204-1%206-4%206-2%200-2%201-2%203%200%204%202%203%206-2%202-3%203-3%2010-3s8%200%208%202l-2%203-2%201%204%201c1-1%202-1%203%201%202%202%201%205-2%205l-1%201-4%203-4%202-4%202c-4%202-7%204-8%207l-3%202-4%202-3%202-2%202c0%204-1%206-3%206l-1%202-3%204c-4%204-6%209-5%2010l-1%203v3c0%202%200%202-2%202s-6%206-6%2010c0%200-1%202-3%202-5%202-7%209-5%2014%201%202%201%204-2%209v7l1%202-1%202-1-1-3-2c-3-1-3-1-2-2%202%200%202-1%200-2h-1a934%20934%200%2000-17-12c-7-5-13-8-19-8-7%200-10-2-7-5%202-2%204-6%203-7l1-4%202-3%202-3%203-5%202-7%203-9%203-4%202-5%202-1%201-2%201-4%204-13c0-2-1-4-5-7-3-2-5-5-5-6l-3-3-11-8-5-3-3-2c-2-3-15-9-19-10-6-1-11%202-6%203%201%201%200%201-2%201-4%200-8%203-8%205l-3%202-3%201%203%202c4%201%208%201%209-1%201-1%203-2%207-2%203%200%204%200%203%201s-1%201%203%203l4%202%203%201v4c1%202-3%206-5%206l-2%202-5%203-5%203-7%203-8%202c-2%201-3%201-6-1-5-2-9-1-5%202%202%201%202%202-3%205l-4%207c0%206%200%206-4%201-7-11-17-18-23-17h-2l3%203%205%203%204%205%201%202c1%202-1%209-3%209l-3%202-2%202-2-2c-1-3-3-3-3%200l-2%202-4%202c-4%203-4%203-4%200l-1-3-1%202-2%201-2-1%202-2%202-1c0-2%201-2%203-1%202%200%203%200%205-3l1-5-1%201h-2c-1%200-8%204-10%207l-11%204c-9%202-10%203-9%204%200%203-3%203-5%200-1-2-3-3-3-1s0%203-3%203c-5%200-23%204-29%206-5%201-5%201-3%203l5%201c2-1%204%200%205%201%202%202%201%202-1%202l-4%201-2%201v2c0%202%200%202-2%202l-5%202c-2%201-3%201-9-1l-16-3h-8v2l4%208%201%202-2%201c-2%200%200%203%208%2011s18%2014%2025%2016c6%201%206%202%203%205l-3%206c1%203%200%205-3%205-1-1-1-1-1%202v3l-2%203-2%202-2%201-2%203c-2%201-3%204-1%204l1%201-2%201c-1-1-5%201-7%203-1%202-3%203-3%201%200-3-2-3-6%202-5%206-5%206%202%205%204-2%2019-1%2027%201a454%20454%200%200041%207l9%203c2%200%203%200%202%201-5%201-8%208-4%209%204%202%2018-2%2018-5l1-1v1l1%203c3%203%204%206%203%206l-1%202%202-1c1-1%201-1%201%201v2l1%203c-1%202-2%202-7%202l-6-1%208%202%208%203%201%203c0%201%200%202-1%201l-3-1-3-1-1-1-1%202-2%202-3%203c0%202-3%205-7%206h-12l-3-1c-1%200-2%200-1-1l2-1%202-2a1146%201146%200%2001-92-5l-1%204c0%204%200%205%208%2011l9%206%2012%203c31%205%2032%205%2031%206v1c1-1%207%203%2012%208l4%203%201%201c0%202%2012%2011%2014%2011s4%202%207%205%205%204%207%204h2l-1%201v1l2%201c1-1%201-1%201%201-1%200-1%201%200%200l1%201c0%202%205%207%206%207l-1-2c-2-3-4-8-3-9l2%201c2%201%202%201%202-1l1-2%202-1c3-2%204%200%202%202s-1%203%201%201c1-1%202%200%204%205l3%205c2%202%200%205-3%205-2-1-5%202-5%205s-3%204-12%204-11%201-7%203v1l-1%203c-1%202-3%203-3%200l-1-1c-1%201-2%200-2-1a86%2086%200%2000-21-30c-8-12-13-15-13-7l-1%205-1%203c0%202%200%203-2%203-1%200-2%200-2%204s0%204-4%204l-8%205-5%204-1%202h1c2-1%202-1%203%201s5%203%209%201c3-1%203-1%203%201l1%202%209%209c0%202%2014%2015%2023%2021l7%205%201%201%209%203%2020%206%202%201%203%202h4l-3%201-6-1-5-2-25-9c-16-8-20-11-31-22l-11-10-3-2-2%203-1%206-1%203v1l-1%203c-1%201-1%201-1-1v-2l-1%202c-1%203-3%202-4-4-1-4-1-4-2-2-4%2010-3%2015%202%2020l4%204c2%200%207%208%205%209l-2%206-1%205-2-5c-4-7-12-18-13-17-2%202%200%206%205%2011l12%2016c5%208%2019%2011%2055%2013h18l8%204%209%204%208%204c10%205%2023%205%2033%201a675%20675%200%20010%20135l-1%2016h29c26%200%2028%200%2028-2l-1-8c-2-9-4-76-5-138l-1-20%203-1a726%20726%200%200177-20c3-2%206-3%207-2l5-1c7-1%2013-7%2033-36a191%20191%200%20019-12l2-4%203-5a2781%202781%200%200132-61%201474%201474%200%200063-148%20280%20280%200%20018-23c0-4%202-9%204-13l4-11c2-7%204-11%206-11s10-5%2012-7l5-8%205-7%201-2%201-2%208-11a2449%202449%200%200129-41l6-4%203-2%203-3%204-3%204-2c2-2%204-3%205-2%202%201%203%204%202%204-2%200%200%202%205%205%207%205%207%206%207-17l-1-20c-1%200-3-7-2-8%203-2%203-9%203-56V0H992v5m-21%2070c-3%203-4%205-2%205l1%204-1%204-1-4c0-6-2-5-2%202-1%2010-1%2010%202%2010s3%200%203-3l2-4%201-5%201-4%201-4c0-5-1-5-5-1M758%20206l-3%202h9c19%201%2028%203%2028%206%200%202%204%201%205%200%201-2%201-9-1-9h-28c0-2-7-1-10%201m-35%2068l-8%202c-4%200-7%201-7%202-2%202-10%206-13%206v1c1%201%200%202-3%202l-8%204c-5%204-13%207-16%207-4%200%200%203%206%204h7c3-3%2012-7%2018-9%208-2%2013-4%2013-5l2-1%203-1-3-1h-7c-3%200-3%200%202-1l15-5c0-1%201-2%203-2%203-1%203-1%202-3h-6m71%2032l-15%207c-13%206-20%208-33%208-4%200-5%201-9%203-9%208-24%2013-38%2013h-8l2%204c4%206%205%2011%205%2021l-1%2010%203-2a530%20530%200%200035-37h4c11%204%2018%2014%2021%2027l1%204%2028-14%2010-6c2-1%202-1%201-2l-2-19-1-18-3%201m44%2018l-7%205-4%203-2%202h-2l-7%204h-2c-2%200-2%200-1%201v1h-2c1%201-2%202-4%201v2l-3%202-4%202-3%201-4%202v1c1%200-9%206-12%206v2l-2%201-4%202c-3%203-9%206-11%206h-1c0%202-6%207-8%207l-2%201c-2%202-2%202-5%200-2-1-3-1-2-2h2l2%201-1-2%204-3%203-3-7%203-14%208-8%204%204%205%2011%2015a37328%2037328%200%200113%2018v-3l1-1%201-2%208-8c1-1%202-2%203-1l5-2c3-4%205-4%205%201%200%203%200%204%202%204s2-1%202-4c0-5%201-5%203%200l3%204%204-8c0-2%202-3%204-1l2%201%202%201h3c3%200%203%200%202-2l-3-2-2-1%202-1%202-1%202-2%202-1c0-2%206-7%2011-9%203-1%205-3%205-4s2-2%204%200c3%202%205%201%203-1s-1-4%203-4l3-2c0-3%209-8%2012-8l2-1%201-2%204-2c1-2%203-3%205-3%203%200%204%201%202%203-2%200-1%202%202%203%203%200%204-3%201-6l-1-3%203-6%202-5-3-3c-2-2-3-3-5-2-3%200-3%200-2-1l2-2-9-5c-2%200-2%200-1-1s0-1-2-2l-4-1h-8M348%20445c-2%202-2%202-1%204%202%204%207%205%2017%204%208-1%2010-2%206-3l-2-2c0-4-17-6-20-3m338%2074l4%205%205%206%205%204%204%203%204%202%204%202c2%202%2022%209%2026%209%202%200%201-1-4-3-17-5-29-13-40-23-7-7-10-8-8-5m69%2044l3%202c2%201%205%203%205%205%202%204%206%204%209%201l3-2-2-3c-5-3-6-3-10-2h-3l-5-1m437%2049v4h-16v16h-16v8h-8v8h-8v8h-16v8h-8v-8h-8v-8h-40v8h-24v8h-16v8h-16v8h-32v8h-19v8h-13v4l-1%204c-2%200-2%201-2%204%200%204%200%204-2%204-3%200-3%200-3%204s0%204-3%204-3%200-3%204-2%206-6%206-4%200-4%203%200%203-4%203h-4v8h-4c-4%200-4%200-4%203v3h288V608h-8v4'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.5957446808510638,"src":"/static/d6ba358698bbb057b376f67299ea75cd/21095/banner.jpg","srcSet":"/static/d6ba358698bbb057b376f67299ea75cd/36b10/banner.jpg 300w,\n/static/d6ba358698bbb057b376f67299ea75cd/88367/banner.jpg 600w,\n/static/d6ba358698bbb057b376f67299ea75cd/21095/banner.jpg 1200w,\n/static/d6ba358698bbb057b376f67299ea75cd/97ce3/banner.jpg 1800w,\n/static/d6ba358698bbb057b376f67299ea75cd/d23b7/banner.jpg 1920w","sizes":"(max-width: 1200px) 100vw, 1200px"},"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAerXZzw5amm3KLIFf//EABsQAAIDAAMAAAAAAAAAAAAAAAACARESITEy/9oACAEBAAEFAkvDMZlh/Hckl82f/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEQEv/aAAgBAwEBPwFGr//EABgRAAIDAAAAAAAAAAAAAAAAAAABEBJR/9oACAECAQE/AXhWf//EABkQAAIDAQAAAAAAAAAAAAAAABARAAECcf/aAAgBAQAGPwKg4oqO+j//xAAbEAEAAwEAAwAAAAAAAAAAAAABABEhMUFR8P/aAAgBAQABPyF6zahUzmNEFP0JtdQ9qYYRMF9fBLT/2gAMAwEAAgADAAAAEEvYwv/EABcRAQADAAAAAAAAAAAAAAAAAAEAECH/2gAIAQMBAT8QA7FX/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQAQIf/aAAgBAgEBPxBpiAv/xAAcEAEAAwEBAAMAAAAAAAAAAAABABEhMVFBYZH/2gAIAQEAAT8QU9WH5EEI12viK6bcE6ewbTAMgGvjhh9rHDACiUoQxrEn0n//2Q==","width":1200,"height":1200,"src":"/static/d6ba358698bbb057b376f67299ea75cd/ebdd7/banner.jpg","srcSet":"/static/d6ba358698bbb057b376f67299ea75cd/ebdd7/banner.jpg 1x,\n/static/d6ba358698bbb057b376f67299ea75cd/b9876/banner.jpg 1.5x"}}}}}}},"pageContext":{}}}